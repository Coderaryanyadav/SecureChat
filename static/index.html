<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureChat | Stealth Communication</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
    <meta name="description" content="Secure, private, end-to-end encrypted messaging">
</head>

<body>
    <!-- Global Background Engine -->
    <div class="void-bg"></div>

    <!-- Login Screen -->
    <div id="login-screen" class="auth-viewport">
        <div class="auth-box">
            <div class="auth-brand">
                <div class="logo-symbol"
                    style="width: 64px; height: 64px; font-size: 32px; border-radius: 20px; box-shadow: 0 10px 40px var(--p-accent-glow);">
                    S</div>
                <h1 style="margin-top: 24px; font-size: 48px;">SecureChat</h1>
                <p>Ultra-Private. End-to-End. Absolute.</p>
            </div>

            <div id="login-form">
                <div class="input-stack">
                    <input type="text" id="login-username" placeholder="Username" autocomplete="username">
                    <input type="password" id="login-password" placeholder="Password" autocomplete="current-password">
                </div>

                <button id="login-btn" class="main-action">Enter the Void</button>

                <div class="auth-footer">
                    <span>New here? <a href="#" id="show-register">Create Identity</a></span>
                    <a href="#" id="show-recover" class="recover-link">Lost access?</a>
                </div>
            </div>

            <div id="register-form" class="hidden">
                <div class="input-stack">
                    <input type="text" id="register-username" placeholder="Choose Username" autocomplete="username">
                    <input type="password" id="register-password" placeholder="Choose Password"
                        autocomplete="new-password">
                </div>

                <div class="pass-requirement">
                    Min. 12 chars, upper/lower/num/symbol
                </div>

                <button id="register-btn" class="main-action">Initialize Identity</button>

                <div class="auth-footer">
                    <span>Have access? <a href="#" id="show-login">Log In</a></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Shell -->
    <div id="chat-screen" class="app-shell hidden">
        <!-- Rail Navigation (Narrow Left) -->
        <nav class="app-rail">
            <div class="rail-top">
                <div class="rail-item active" title="Chats">üí†</div>
                <div class="rail-item" title="Contacts">üë•</div>
                <div id="settings-btn" class="rail-item" title="Settings">üõ†Ô∏è</div>
            </div>
            <div class="rail-bottom">
                <div id="theme-toggle" class="rail-item" title="Toggle Theme">üåó</div>
                <div class="user-avatar" id="global-user-avatar">?</div>
            </div>
        </nav>

        <!-- Dynamic Content Sidebar -->
        <aside class="app-sidebar">
            <div class="sidebar-top">
                <h3>Chats</h3>
                <button id="new-chat-btn" class="icon-btn" title="Start Chat">‚äï</button>
            </div>

            <div class="search-wrapper">
                <input type="text" id="search-input" placeholder="Search conversations...">
            </div>

            <div id="chat-list" class="sidebar-list">
                <!-- Dynamically populated -->
            </div>
        </aside>

        <!-- Primary Canvas -->
        <main class="app-canvas">
            <!-- Empty State -->
            <div id="empty-state" class="canvas-placeholder">
                <div class="placeholder-icon"
                    style="font-size: 80px; margin-bottom: 32px; filter: drop-shadow(0 0 20px var(--p-accent-glow));">üåå
                </div>
                <h2 style="font-size: 32px; margin-bottom: 16px; letter-spacing: -1px;">Secure Dimension</h2>
                <p style="max-width: 400px; margin: 0 auto 32px; color: var(--p-text-dim); line-height: 1.6;">Initialize
                    a conversation or select an existing room to begin encrypted transmission within the void.</p>
                <button id="new-chat-btn-empty" class="main-action" style="max-width: 240px;">Initialize Room</button>
            </div>

            <!-- Active Chat Area -->
            <div id="active-chat-container" class="active-chat hidden">
                <header class="chat-header">
                    <div class="header-info">
                        <button id="back-btn" class="icon-btn mobile-only">‚Üê</button>
                        <div class="chat-avatar-lg" id="chat-avatar">?</div>
                        <div class="chat-details">
                            <h3 id="chat-name">Initialising...</h3>
                            <span id="chat-status" class="status-label">Updating phantoms...</span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="icon-btn">üîç</button>
                        <button class="icon-btn">‚ãÆ</button>
                    </div>
                </header>

                <div id="messages-container" class="message-canvas">
                    <!-- Messages flow here -->
                </div>

                <!-- Interaction HUD -->
                <div class="chat-hud">
                    <div id="reply-preview" class="reply-overlay hidden">
                        <div class="reply-content">
                            <span class="reply-user" id="reply-to-user"></span>
                            <p id="reply-preview-text"></p>
                        </div>
                        <button id="cancel-reply" class="close-btn">‚úï</button>
                    </div>

                    <div id="typing-indicator" class="typing-pill hidden">
                        <span id="typing-user"></span> is thinking...
                    </div>

                    <div class="input-wrapper">
                        <button id="attach-btn" class="hud-btn">üìé</button>
                        <input type="file" id="file-input" class="hidden">
                        <textarea id="message-input" placeholder="Type a message..." rows="1"></textarea>
                        <button id="send-btn" class="send-action">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals (Centralised System) -->
    <div id="system-overlay" class="modal-overlay hidden">
        <!-- New Room Modal -->
        <div id="new-chat-modal" class="system-modal hidden">
            <div class="modal-header">
                <h2>Initialize Room</h2>
                <button class="close-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="field">
                    <label>Dimensional ID</label>
                    <div class="input-with-action">
                        <input type="text" id="room-id-input" placeholder="e.g. shadow-7">
                        <button id="generate-room-id">Auto</button>
                    </div>
                </div>
                <div class="field">
                    <label>Access Seal (Password)</label>
                    <input type="password" id="room-password-input" placeholder="Required for encryption">
                </div>
                <button id="join-room-btn" class="main-action">Open Dimension</button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="system-modal hidden">
            <div class="modal-header">
                <h2>System Settings</h2>
                <button class="close-modal">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <span>Identity Export</span>
                    <button id="export-data-btn" class="btn-sm">Export</button>
                </div>
                <div class="setting-item">
                    <span>Theme Mode</span>
                    <button id="modal-theme-toggle" class="btn-sm">Switch</button>
                </div>
                <div class="setting-item critical">
                    <span>Identity Purge</span>
                    <button id="delete-account-btn" class="btn-sm danger">Purge</button>
                </div>
                <div class="modal-logout-zone">
                    <button id="logout-btn" class="btn-ghost">Disconnect Session</button>
                </div>
            </div>
        </div>

        <!-- Recovery Modal -->
        <div id="recovery-modal" class="system-modal hidden">
            <div class="modal-header">
                <h2>Access Recovery</h2>
            </div>
            <div class="modal-body">
                <!-- Transitioning views inside script -->
                <div id="recovery-key-display" class="hidden">
                    <p class="warning-text">Store this key. It is your only recovery path.</p>
                    <div class="key-box">
                        <code id="recovery-key-text"></code>
                    </div>
                    <button id="copy-recovery-key" class="main-action">Copy Key</button>
                    <button id="close-recovery" class="btn-ghost">Done</button>
                </div>

                <div id="recovery-form" class="hidden">
                    <input type="text" id="recover-username" placeholder="Identity">
                    <input type="text" id="recover-key" placeholder="Recovery Key">
                    <input type="password" id="recover-password" placeholder="New Access Seal">
                    <button id="recover-btn" class="main-action">Restore Access</button>
                    <button id="cancel-recover" class="btn-ghost">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications HUD -->
    <div id="offline-indicator" class="system-alert hidden">
        Communication link severed. Reconnecting...
    </div>

    <script src="/static/script.js"></script>
</body>

</html>